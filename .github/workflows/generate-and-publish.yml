name: Generate and Publish Pages

on:
  push:
    branches: [ main ]

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Generate personalAI.html from template
        env:
          ELEVENLABS_AGENT_ID: ${{ secrets.ELEVENLABS_AGENT_ID }}
        run: |
          echo "Repository root contents:"
          ls -la
          echo "Looking for generator script..."
          if [ -f personal-ai-site/scripts/generate-personalAI.js ]; then
            echo "Found at personal-ai-site/scripts/generate-personalAI.js — running"
            node personal-ai-site/scripts/generate-personalAI.js
          elif [ -f scripts/generate-personalAI.js ]; then
            echo "Found at scripts/generate-personalAI.js — running"
            node scripts/generate-personalAI.js
          else
            echo "ERROR: generate-personalAI.js not found in expected locations"
            echo "Searched: personal-ai-site/scripts/generate-personalAI.js and scripts/generate-personalAI.js"
            exit 1
          fi

      - name: Upload artifact for GitHub Pages
        uses: actions/upload-pages-artifact@v2
        with:
          path: personal-ai-site

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v1
